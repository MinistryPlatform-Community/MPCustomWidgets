<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Custom Widget Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">       

    <script src="https://kit.fontawesome.com/2c66da8e8c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />   
    </head>
    
    <body>
        <div class="container">

            <h2>Calendar</h2>    


            <div class="row mb-3">
                <div class="col-4 text-end">
                    <button class="btn btn-secondary" id="btnFeatured">Featured Events</button>
                </div>
                <div class="col-4 text-center">
                    <button class="btn btn-secondary" id="btnCalendar">Calendar</button>
                </div>
                <div class="col-4">
                    <button class="btn btn-secondary" id="btnCalendarGrid">Calendar (Grid)</button>
                </div>
            </div>
    
            <div id="paneFeatured"></div>
            <div id="paneCalendar" style="display: none;"></div>
            <div id="paneCalendarGrid" style="display: none;">
                <div id="calendar" style="height: 600px;"></div>
            </div>



            
        <script type="text/javascript">
            // Use Javascript to detect the current Date so we can request future events
            var today = new Date();
  
            var year = today.getFullYear(); // Get the year (e.g., 2023)
            var month = today.getMonth() + 1; // Get the month (0-based index, so add 1 for January to be 1)
            var day = today.getDate(); // Get the day of the month (1-31)
  
            var featuredTag = `
                <div id="CustomFeaturedEvents" 
                  data-component="CustomWidget"             
                  data-template="/Widgets/Calendar/template/FeaturedEventsTemplate.html" 
                  data-requireUser="false" 
                  data-cache="true" 
                  data-host="calvaryccm" 
                  data-useCalendar="true" 
                  data-params="{params}" 
                  data-debug="true"></div>`;
  
            var calendarTag = `          
                <div id="CustomCalendar" 
                  data-component="CustomWidget"             
                  data-template="/Widgets/Calendar/template/calendarTemplate.html" 
                  data-requireUser="false" 
                  data-cache="true" 
                  data-host="calvaryccm" 
                  data-useCalendar="true" 
                  data-params="{params}" 
                  data-debug="true"></div>`;
  
              var featuredParams = `?startDate=${month}%2F${day}%2F${year}&GetFeaturedEventsOnly=true&GetRegistrationEventsOnly=false&CongregationIDs=5&OnlyApprovedEvents=true&OnlyUnApprovedEvents=false&ShowExtendedData=false&DataFormat=json&convertToUTC=true`;
  
              var calendarParams = `?startDate=${month}%2F${day}%2F${year}&GetFeaturedEventsOnly=false&GetRegistrationEventsOnly=false&CongregationIDs=5&OnlyApprovedEvents=true&OnlyUnApprovedEvents=false&ShowExtendedData=false&DataFormat=json&convertToUTC=true`;

              var featuredEl = document.getElementById("paneFeatured");
              featuredEl.innerHTML = featuredTag.replace("{params}", featuredParams);
  
              var calendarEl = document.getElementById("paneCalendar");
              calendarEl.innerHTML = calendarTag.replace("{params}", calendarParams);
  
              function showCalendar()
              {
                  var calendarPanel = document.getElementById("paneCalendar");
                  var calendarPanelGrid = document.getElementById("paneCalendarGrid");
                  var featuredPanel = document.getElementById("paneFeatured");
                  hideElement(featuredPanel);
                  hideElement(calendarPanelGrid);
                  showElement(calendarPanel);
              }

              function showCalendarGrid()
              {
                  var calendarPanel = document.getElementById("paneCalendar");
                  var calendarPanelGrid = document.getElementById("paneCalendarGrid");
                  var featuredPanel = document.getElementById("paneFeatured");
                  hideElement(featuredPanel);
                  showElement(calendarPanelGrid);
                  hideElement(calendarPanel);
              }
  
              function showFeatured() 
              {
                  var calendarPanel = document.getElementById("paneCalendar");
                  var calendarPanelGrid = document.getElementById("paneCalendarGrid");
                  var featuredPanel = document.getElementById("paneFeatured");
                  hideElement(calendarPanel);
                  hideElement(calendarPanelGrid);
                  showElement(featuredPanel);
              }
            
              function showElement(el)
              {
                el.style.display = "block";
              }
  
              function hideElement(el)
              {
                el.style.display = "none";
              }
  
              (document.getElementById("btnCalendar")).addEventListener("click", function(){
                showCalendar();
              });

              (document.getElementById("btnCalendarGrid")).addEventListener("click", function(){
                showCalendarGrid();
              });
  
              (document.getElementById("btnFeatured")).addEventListener("click", function(){
                showFeatured();
              });
          </script>
            

            <script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.ie11.min.js"></script>

            <script type="text/javascript">
                const Calendar = tui.Calendar;

                const container = document.getElementById('calendar');
                const options = {
                    defaultView: 'month',
                    useDetailPopup: true,
                    timezone: {
                        zones: [{
                            timezoneName: 'America/New_York',
                            displayLabel: 'GMT-5:00',
                            tooltip: 'Eastern'
                        }]
                    },
                    calendars: [
                        {
                        id: 'Melbourne',
                        name: 'Melbourne',
                        backgroundColor: '#539ae6',
                        },
                        {
                        id: 'Viera',
                        name: 'Viera',
                        backgroundColor: '#07853d',
                        },

                    ],

                    useDetailPopup: true,
                    theme: {
                        month: {
                            template: {
                                popupDetailBody(date) {
                                    return `<div>${date.format('dddd, MMMM Do YYYY')}</div>`;
                                },        
                            }
                        }
                    }
                };

                const calendar = new Calendar(container, options);

                fetch('https://calvaryccm.cloudapps.ministryplatform.cloud/sky/api/Events/GetEvents?startDate=12%2F1%2F2023&endDate=1%2F1%2F2024&GetFeaturedEventsOnly=false&GetRegistrationEventsOnly=false&CongregationIDs=5&OnlyApprovedEvents=true&OnlyUnApprovedEvents=false&ShowExtendedData=false&DataFormat=calendarwidget&convertToUTC=true', 
                {
                    headers: {"Content-Type": "application/json; charset=utf-8"}
                })
                .then(function (response) {
                    response.json()
                    .then(function (response) {                        
                        for(var i = 0; i < response.length; i++){
                            response[i].calendarId="Melbourne";
                        }

                        console.log(response);
                        calendar.createEvents(response);
                    });
                });

                fetch('https://calvaryccm.cloudapps.ministryplatform.cloud/sky/api/Events/GetEvents?startDate=12%2F1%2F2023&endDate=1%2F1%2F2024&GetFeaturedEventsOnly=false&GetRegistrationEventsOnly=false&CongregationIDs=6&OnlyApprovedEvents=true&OnlyUnApprovedEvents=false&ShowExtendedData=false&DataFormat=calendarwidget&convertToUTC=true', 
                {
                    headers: {"Content-Type": "application/json; charset=utf-8"}
                })
                .then(function (response) {
                    response.json()
                    .then(function (response) {                        
                        for(var i = 0; i < response.length; i++){
                            response[i].calendarId="Viera";
                        }

                        console.log(response);
                        calendar.createEvents(response);
                    });
                });                

            </script>
        </div>            



        <script type="text/javascript" src="../../dist/customWidget.js"></script>    

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>            
    </body>
</html>